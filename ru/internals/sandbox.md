---
layout: page
title:  Песочница
date: 2016-03-30 17:45:00 EET
categories: ru
---

   Песочница, как много в этом слове для сердца сервера слилось...

   Короче, песочница - это режим работы программы, когда она, при любых своих действиях (позволяется все - бросаться песком, есть его, сыпать, кучиличи лепить) не может навредить системе, в которой запущена (но из песочницы - не выходить).
   
   Песочница на данный момент релизована для вариантов Linux систем, ядро которых включает поддержку SECCOMP (prctl + PR_SET_SECCOMP). Переход в режим seccomp производится либо с помощью параметра командной строки "--seccomp", в таком случае интерпретатор сразу запускается в режиме песочницы; либо с помощью системного вызова 157 - (syscall 157 #f #f #f). 
   
   Что значит песочница конкретнее:
  * программе запрещается создавать, удалять, открывать на чтение и/или запись файлы
  * проводить аналогичные действия с папками
  * а так же с сокетами
  * запускать, останавливать процессы
  * пытаться каким-либо образом выйти из песочницы

   Что разрешается:
  * выполнять любые внутренние функции Otus Lisp, кроме тех, что ведут к запрещенным действиям
  * читать/писать уже открытые к моменту перехода в песочницу файлы/сокеты
  
   В случае, если в песочнице попытаться открыть новый файл, например с помощью (open-output-file "some-file") - функция откажется это делать, вернув #false. Если же попытаться каким-либо образом выйти из песочницы (например, с помощью попытки напрямую вызвать системную функцию fopen или попытавшись испортить кучу и выполнить непосредственный байт-код) - система автоматически убъет сеанс работы в песочнице без какого-либо уведомления.
   
   Как оно в деле? Вполне неплохо - в песочнице, например, работают серверные части терминальных сессий клиентов Otus Lisp (с этой страничке проекта), обеспечивая необходимый уровень защиты для кооперативной работы.