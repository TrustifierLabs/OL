---
layout: page
title:  Числа
date:   Sat 28 Nov 2015 01:07:41 AM EET
categories: en
---
   Числа, это те редкие элементы Ol, которые могут быть использованы как по значению (как value типы), так и по ссылке (как reference). Такой дуализм сделан с целью оптимизации скорости работы виртуальной машины.

   Работа с value типами в Ol наиболее быстрая из всего, что может обеспечить виртуальная машина. Они не требуют размещения в памяти, математические операции с ними выполняются одной командой виртуальной машины (а не целой большой функцией) и, по большому счету, по скорости мало отличается от скорости операций на C или ассемблере.

   Как value можно использовать небольшие целые числа, которые укладываются в количество бит машинного слова платформы минус 8 бит для служебной информации. Это 16777215 для 32-битных систем и 72057594037927935 для 64-битных. Вполне достаточно для большинства прикладных задач. Числа, которые превышают эти значения автоматически разбиваются на пары по 24 и 56 бит соответственно и размещаются в куче.

   В контексте Ol такие "маленькие" числа называются fix и имеют тип type-fix+ и type-fix-.

   Вот перечень примитивных команд виртуальной машины с опкодом для быстрой работы с ними. Многие из этих команд возвращают более одного значения, приводятся примеры:

* 44: (fx:< a b) - сравнение a и b, возвращает #true если
   - a - число, b - ссылка
   - a - число и b - число, a < b
   - a - ссылка и b - ссылка, a < b

* 38: (fx:+ a b) - сложение a и b, возвращает пару чисел (values сумма переполнение)
<pre><code id="FX1" data-language="scheme">
(let* ((a b (fx:+ 4 3))) (print "a: " a ", b: " b))
; ==> a: 7, b: #false

(let* ((a b (fx:+ 4 72057594037927935))) (print "a: " a ", b: " b))
; ==> a: 3, b: #true
</code><button class="doit" onclick="doit(FX1.textContent)">отправить в терминал</button></pre>

* 40: (fx:- a b) - вычитаение b из a, возвращает пару чисел (values разница обратное-переполнение)
<pre><code id="FX2" data-language="scheme">
(let* ((a b (fx:- 4 3))) (print "a: " a ", b: " b))
; ==> a: 1, b: #false

(let* ((a b (fx:- 3 4))) (print "a: " a ", b: " b))
; ==> a: 72057594037927935, b: #true
</code><button class="doit" onclick="doit(FX2.textContent)">отправить в терминал</button></pre>

* 39: (fx:* a b)

* 26: (fx:/ ah al b) - деление a на b, возвращает тройку чисел (values старшая-часть-частного младшая-часть-частного остаток)

* 58: (fx:>> a n)

* 59: (fx:<< a n)

* 55: (fx:and a b)

* 56: (fx:or a b)

* 57: (fx:xor a b)

   Целые числа, как базовый элемент всех чисел (можно прочитать в [базовом разделе](?ru/basic-concepts)), 

