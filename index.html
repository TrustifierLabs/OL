<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Owl Lisp</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">

    <script src="javascripts/jquery-2.1.1.min.js"></script>
    <link  href="stylesheets/jquery.terminal.css" rel="stylesheet"/>
    <script src="javascripts/jquery.terminal-0.8.8.min.js"></script>
    <script src="javascripts/jquery-tools-flashembed.js">  </script>
    <script src="javascripts/jquery.history-1.8.2.min.js"></script>
    <script src="javascripts/jsocket-1.0.0.min.js"></script>

    <script src="javascripts/rainbow-1.1.9.min.js"></script>
    <script src="javascripts/language/scheme.js"></script>
    <link  href="stylesheets/language/themes/github.css" rel="stylesheet">

    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Owl Lisp</h1>
        <p>Project site
          (<a href="?ru">rus</a>)
          (<a href="?en">eng</a>)
        </p>

        <p class="view"><a href="https://github.com/yuriy-chumak/OL">View GitHub project page</a></p>

        Remote terminal session:
        <div id="terminal" class="terminal">
          <noscript><b>Looks like you have disabled scripts for this page. Please enable it to be able to continue with.</b></noscript>
        </div>
      </header>
      <!-- ====================================================================================== -->
      <section id="content">
         <h3> <a id="welcome" class="anchor" href="#welcome" aria-hidden="true"><span class="octicon octicon-link"></span></a>
   Welcome.
         </h3>
      <p>
      OL (Owl Lisp) is a purely (<i>mostly</i>) functional dialect of Lisp.
      It implements an extended subset of <a href="http://www.schemers.org/Documents/Standards/R5RS/">R5RS</a> Scheme but has been renamed as a Lisp by its author mainly to avoid confusion.
      </p>

      <p>
      You can try <b>ol</b> in the provided terminal on this page, if it successfully connected to server. For example, type
      <pre><code id="fild1" data-language="scheme">(fold * 1 (isota 1 1 99))</code><button class="doit" onclick="doit(fold1.textContent)">do it for me.</button></pre>
      this must output 99! for you.
      </p>

      <p>
      Or you can try more interesting example - here will be task description.
      <pre><code id="fold2" data-language="scheme">(print "here will be task code")</code><button class="doit" onclick="doit(fold2.textContent)">do it for me.</button></pre>
      </p>

         <h3> <a id="designe-goals" class="anchor" href="#designe-goals" aria-hidden="true"><span class="octicon octicon-link"></span></a>
   Design goals
         </h3>
      <p>
      <ol>
         <li>Simple core language</li>
         <li>Mostly implemented in itself</li>
         <li>All data structures are immutable</li>
         <li>Embeddable</li>
         <li>Easy interoperate with existing native code</li>
         <li>...</li>
      </ol>
      </p>

         <h3> <a id="creating-pages-manually" class="anchor" href="#creating-pages-manually" aria-hidden="true"><span class="octicon octicon-link"></span></a>
   Etc.
         </h3>
      </section>
      <footer style="text-align:right">
         <br><small>Hosted on GitHub Pages &mdash; Theme by <a href="http://github.com/orderedlist">orderedlist</a></small>
         <br><small>Used JQuery Terminal Emulator plugin by <a href="http://terminal.jcubic.pl/">JQueryTerminal</a></small>
         <br><small>Used Rainbow code syntax highlighting library by <a href="https://craig.is/making/rainbows">Craig Campbell</a></small>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

    <script>
var socket;

var terminal =
$('#terminal').terminal(function(command, terminal) {
   socket.writeFlush(command);
}, {
   prompt: '> ',
   name: 'repl',
   greetings: '\
OL - Owl Lisp -- yet another pet lisp\n\
Copyright (c) 2014 Aki Helin\n\
Copyright (c) 2014, 2015 Yuriy Chumak\n\
~~~~~~~~~~~~~~~~~\n',
   height: 200,
   enabled: false,

   onInit: function(terminal) {
      terminal.pause();
      terminal.echo("Loading...");

      JSocket.init("TCP.swf", function () {
         console.log("yes");
         socket = new JSocket({
            connectHandler: connectHandler,
            dataHandler:    dataHandler,
            closeHandler:   closeHandler,
            errorHandler:   errorHandler
         });
         socket.connect("iaaa.dlinkddns.com", 80);
         console.log("Trying to connect...");
      });
      function connectHandler() {
         terminal.echo("Connected.");
         terminal.focus();
         socket.write("GET /ol HTTP/1.0"         + "\x0D\x0A");
         socket.write("Host: iaaa.dlinkddns.com" + "\x0D\x0A");
         socket.write("\x0D\x0A");
         socket.flush();
         terminal.resume();
      }
      function dataHandler(data) {
         if (data.length > 2 && data.indexOf('> ', data.length - 2) !== -1)
            terminal.echo(data.substring(0, data.length - 2));
         else
            terminal.echo(data);
      }
      function closeHandler() {
         terminal.pause();
         terminal.echo("Disconnected.");
         alert('lost connection')
      }
      function errorHandler(errorstr) {
         terminal.pause();
         terminal.echo("Error: " + errorstr);
         alert(errorstr);
      }
   }
});
    </script>

    <script>
function doit(text)
{
   terminal.insert(text);
   terminal.focus();
}

var History;

function updateLink()
{
   if ($(this).context.attributes.href.value.startsWith("?"))
   $(this).click(function (event) {
      event.preventDefault();
      var link = $(this).context;
      var href = link.attributes.href.value; // was: nodeValue

      var state = History.getState();
      History.replaceState({
            href:  state.data.href,
            title: document.title,
            content: $("#content").html()
         },
         state.title, state.url);
      History.pushState({ href: href }, document.title, href);
   });
}

// update all links to dynamic load pages:
$('a').each(updateLink);

function show(page)
{
   page = page || "?en"; // default page
   $("#content").load(page.substr(1) + ".html", function() {
      $('#content a').each(updateLink);
      Rainbow.color();
   });
}

// history manipulations:
(function(window,undefined) {
   History = window.History;
   var historyChanged = function(event) {
      var state = History.getState(); // Note: We are using History.getState() instead of event.state

      if (state.data.title)
         document.title = state.data.title;
      if (state.data.content) {
         $("#content").html(state.data.content)
         $('#content a').each(updateLink);
      }
      else
         show(state.data.href);
   }
   History.Adapter.bind(window, 'statechange', historyChanged);

   show(window.location.search);
})(window);
    </script>

  </body>
</html>
